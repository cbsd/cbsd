#!/usr/local/bin/cbsd
#v10.1.4
globalconf="${workdir}/cbsd.conf";
MYARG="mode"
MYOPTARG="vhid advskew pass ip interface state inter"
MYDESC="Enable CARP configuration"
ADDHELP="mode - set,show,unset,update\n\
interface - physical iface or 'auto'\n\
advskew - advertisements value, e.g. 100\n\
pass - passwordphrase\n\
vhid - ID, e.g 1\n\
ip - virtual ip, e.g: 192.168.1.200/24\n\
state - master,backup\n"

set -e
. ${globalconf}
. ${workdir}/carp.subr
set +e

. ${subr}
. ${tools}
. ${initenv}
. ${strings}
init $*

set -e
. ${workdir}/carp.subr
set +e

### MAIN
carp_init

if [ "${mode}" = "show" ]; then
	show=1
else
	show=0
fi

case "${mode}" in
	set|show)
		check_vhid
		check_interface
		carp_set
		;;
	unset)
		check_vhid
		check_interface
		carp_unset
		;;
	update)
		check_vhid
		check_interface
		carp_update
		;;
	*)
		err 1 "${MAGENTA}Unknown mode: ${GREEN}${mode}${NORMAL}"
		;;
esac
